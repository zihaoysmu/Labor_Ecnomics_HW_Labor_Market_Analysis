---
title: "Untitled"
output: html_document
date: "2025-11-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(janitor)
library(haven)
library(ggplot2)
library(dplyr)
library(survey)
library(patchwork)
data <- read_dta("C:/document/SMU PhD/Class/labor/labor market analysis/00_project_template/data/clean/march_baker in backery.dta")

dsgn <-svydesign(ids=~1, weights=~wtfinl, data=data)
```


```{r change across month, echo=FALSE}
#1270 is non-retail, 1190 is retail

# Exclude income outlier, add var
data=data %>% 
  filter(inctot<300000) %>% 
  mutate(part=ifelse(wkstat %in% c(14,15,20,22,40,41,42,50,60,99),1,0))
  
df_count_nretial <- data %>%
  filter(ind==1270)%>%
  group_by(year) %>%
  summarise(
    emp = sum(asecwt),
    n=n()
    )
df_count_retial <- data %>%
  filter(ind==1190)%>%
  group_by(year) %>%
  summarise(
    emp = sum(asecwt),
    n=n()
    )

##
p1=ggplot(df_count_nretial, aes(x = year, y = n)) +
  geom_line(size = 1) +
  scale_x_continuous(breaks = 1:12) +
  labs(
    x = "Year",
    y = "Value",
    color = "Year",
    title = "Sample Size by Year for non-retail"
  ) +
  theme_minimal()

p2=ggplot(df_count_retial, aes(x = year, y = n)) +
  geom_line(size = 1) +
  scale_x_continuous(breaks = 1:12) +
  labs(
    x = "Year",
    y = "Value",
    color = "Year",
    title = "Sample Size by Year for Retail"
  ) +
  theme_minimal()

p3=ggplot(df_count_nretial, aes(x = year, y = emp)) +
  geom_line(size = 1) +
  scale_x_continuous(breaks = 1:12) +
  labs(
    x = "Year",
    y = "Value",
    color = "Year",
    title = "Employment by Year for Non-retail"
  ) +
  theme_minimal()

p4=ggplot(df_count_retial, aes(x = year, y = emp)) +
  geom_line(size = 1) +
  scale_x_continuous(breaks = 1:12) +
  labs(
    x = "Year",
    y = "Value",
    color = "Year",
    title = "Employment by Year for Retail"
  ) +
  theme_minimal()

(p1 + p2) / (p3 + p4)

# no apparent pattern
```



```{r, echo=FALSE}
#sex, 0 is male

mean_sex_retail <- with(data %>% filter(ind==1190), sum(asecwt * sex) / sum(asecwt))-1
mean_sex_nretail <- with(data %>% filter(ind==1270), sum(asecwt * sex) / sum(asecwt))-1

#Non-retail has more males

#income
mean_inctot_retail = with(data %>% filter(ind==1190), sum(asecwt*inctot)/sum(asecwt))
mean_inctot_nretail = with(data %>% filter(ind==1270), sum(asecwt*inctot)/sum(asecwt))

mean_incwage_retail = with(data %>% filter(ind==1190), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_nretail = with(data %>% filter(ind==1270), sum(asecwt*incwage)/sum(asecwt))

self_retail = with(data %>% filter(ind==1190), sum(asecwt[classwkr %in% c(13,14)])/sum(asecwt))
self_nretail = with(data %>% filter(ind==1270), sum(asecwt[classwkr %in% c(13,14)])/sum(asecwt))

self_corporated_retail = with(data %>% filter(ind==1190), sum(asecwt[classwkr %in% c(14)])/sum(asecwt))
self_corporated_nretail = with(data %>% filter(ind==1270), sum(asecwt[classwkr %in% c(14)])/sum(asecwt))

mean_incwage_worker_retail = with(data %>% filter(ind==1190,classwkr==21), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_worker_nretail = with(data %>% filter(ind==1270,classwkr==21), sum(asecwt*incwage)/sum(asecwt))

part_retail = with(data %>% filter(ind==1190), sum(asecwt[part == 1])/sum(asecwt))
part_nretail = with(data %>% filter(ind==1270), sum(asecwt[part == 1])/sum(asecwt))

mean_incwage_fulwrk_retail = with(data %>% filter(ind==1190,classwkr==21,part==0), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_fulwrk_nretail = with(data %>% filter(ind==1270,classwkr==21,part==0), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_ptwrk_retail = with(data %>% filter(ind==1190,classwkr==21,part==1), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_ptwrk_nretail = with(data %>% filter(ind==1270,classwkr==21,part==1), sum(asecwt*incwage)/sum(asecwt))

#2014 
mean_incwage_retail14 = with(data %>% filter(ind==1190,year==2014), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_nretail14 = with(data %>% filter(ind==1270,year==2014), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_fulwrk_retail14 = with(data %>% filter(ind==1190,classwkr==21,part==0,year==2014), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_fulwrk_nretail14 = with(data %>% filter(ind==1270,classwkr==21,part==0,year==2014), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_ptwrk_retail14 = with(data %>% filter(ind==1190,classwkr==21,part==1,year==2014), sum(asecwt*incwage)/sum(asecwt))
mean_incwage_ptwrk_nretail14 = with(data %>% filter(ind==1270,classwkr==21,part==1,year==2014), sum(asecwt*incwage)/sum(asecwt))

p5=ggplot(data %>% filter(ind==1190), aes(x = inctot, weight = asecwt)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "white") +
  labs(
    x = "Total Income",
    y = "Weighted Count",
    title = "Hist of Total Income for Retail"
  ) +
  theme_minimal()

p6=ggplot(data %>% filter(ind==1270), aes(x = inctot, weight = asecwt)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "white") +
  labs(
    x = "Total Income",
    y = "Weighted Count",
    title = "Hist of Total Income for Non-retail"
  ) +
  theme_minimal()
p7=ggplot(data %>% filter(ind==1190), aes(x = incwage, weight = asecwt)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "white") +
  labs(
    x = "Total Income",
    y = "Weighted Count",
    title = "Hist of Wage Income for Retail"
  ) +
  theme_minimal()

p8=ggplot(data %>% filter(ind==1270), aes(x = incwage, weight = asecwt)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "white") +
  labs(
    x = "Total Income",
    y = "Weighted Count",
    title = "Hist of Wage Income of Non-retail"
  ) +
  theme_minimal()

(p5+p6)/(p7+p8)

#Non-retail has higher total income


```


```{r pressure, echo=FALSE}

```
